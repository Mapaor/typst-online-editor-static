(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,29554,55319,e=>{"use strict";var t,r,s,i=e.i(36518),o=e.i(39133);Symbol("beforeBuild");let n=["DejaVuSansMono-Bold.ttf","DejaVuSansMono-BoldOblique.ttf","DejaVuSansMono-Oblique.ttf","DejaVuSansMono.ttf","LibertinusSerif-Bold.otf","LibertinusSerif-BoldItalic.otf","LibertinusSerif-Italic.otf","LibertinusSerif-Regular.otf","LibertinusSerif-Semibold.otf","LibertinusSerif-SemiboldItalic.otf","NewCM10-Bold.otf","NewCM10-BoldItalic.otf","NewCM10-Italic.otf","NewCM10-Regular.otf","NewCMMath-Bold.otf","NewCMMath-Book.otf","NewCMMath-Regular.otf"],a=["InriaSerif-Bold.ttf","InriaSerif-BoldItalic.ttf","InriaSerif-Italic.ttf","InriaSerif-Regular.ttf","Roboto-Regular.ttf","NotoSerifCJKsc-Regular.otf"],l=["TwitterColorEmoji.ttf","NotoColorEmoji-Regular-COLR.subset.ttf"];function c(){return d([],{assets:!1})}function u(e){return d([],e)}function d(e,t){let r=function(e){let t=[];if(e&&e?.assets!==!1&&e?.assets?.length&&e?.assets?.length>0){let r={text:"https://cdn.jsdelivr.net/gh/typst/typst-assets@v0.13.1/files/fonts/",_:"https://cdn.jsdelivr.net/gh/typst/typst-dev-assets@v0.13.1/files/fonts/"},s=e.assetUrlPrefix??r;for(let e of Object.keys(s="string"==typeof s?{_:s}:{...r,...s})){let t=s[e];"/"!==t[t.length-1]&&(s[e]=t+"/")}let i=(e,t)=>t.map(t=>(s[e]||s._)+t);for(let r of e.assets)switch(r){case"text":t.push(...i(r,n));break;case"cjk":t.push(...i(r,a));break;case"emoji":t.push(...i(r,l))}}return t}(t),s=async(s,{ref:i,builder:o})=>{t?.fetcher&&i.setFetcher(t.fetcher),await i.loadFonts(o,[...e,...r])};return s._preloadRemoteFontOptions=t,s._kind="fontLoader",s}function f(e){return async(t,{builder:r})=>new Promise(t=>{r.set_package_registry(e,function(t){return e.resolve(t,this)}),t()})}function p(e){return async(t,r)=>{if(r.alreadySetAccessModel)throw Error(`already set some assess model before: ${r.alreadySetAccessModel.constructor?.name}(${r.alreadySetAccessModel})`);return r.alreadySetAccessModel=e,new Promise(t=>{r.builder.set_access_model(e,t=>{let r=e.getMTime(t);return r?r.getTime():0},t=>e.isFile(t)||!1,t=>e.getRealPath(t)||t,t=>e.readAll(t)),t()})}}e.s(["disableDefaultFontAssets",()=>c,"loadFonts",()=>d,"preloadFontAssets",()=>u,"withAccessModel",()=>p,"withPackageRegistry",()=>f],55319);var h=e.i(27007);(t=r||(r={}))[t.vector=0]="vector",t[t.pdf=1]="pdf",t[t._dummy=2]="_dummy";class m{[o.kObject];constructor(e){this[o.kObject]=e}reset(){this[o.kObject].reset()}current(){return this[o.kObject].current()}setAttachDebugInfo(e){this[o.kObject].set_attach_debug_info(e)}}function y(){return new _}s||(s={});class g{[o.kObject];constructor(e){this[o.kObject]=e}compile(e){return this[o.kObject].compile(0,k(e?.diagnostics))}compileHtml(e){return this[o.kObject].compile(1,k(e?.diagnostics))}async query(e){return JSON.parse(this[o.kObject].query(0,e.selector,e.field))}title(){return this[o.kObject].title(0)}vector(e){return this[o.kObject].get_artifact(0,k(e?.diagnostics))||{}}pdf(e){return this[o.kObject].get_artifact(1,k(e?.diagnostics))||{}}}let w=e=>new h.LazyWasmModule(async t=>await e.default(t));function b(){return new S}class _{fontBuilderJs;fontBuilder;async init(t){this.fontBuilderJs=await (t?.getWrapper?.()||e.A(10845)),await w(this.fontBuilderJs).init(t?.getModule?.()),this.fontBuilder=new this.fontBuilderJs.TypstFontResolverBuilder}async getFontInfo(e){return this.fontBuilder.get_font_info(e)}async addFontData(e){this.fontBuilder.add_raw_font(e)}async addLazyFont(e,t){return this.fontBuilder.add_lazy_font(e,t)}async build(e){let t=await this.fontBuilder.build(),r=await e(t);return t.free(),r}}class S{compiler;compilerJs;static defaultAssets=["text"];async init(t){this.compilerJs=await (t?.getWrapper?.()||e.A(10845));let r=this.compilerJs.TypstCompilerBuilder,s={...t||{}},o=s.beforeBuild??=[],n=o.some(e=>void 0!==e._preloadRemoteFontOptions),a=o.some(e=>e._preloadRemoteFontOptions?.assets!==void 0),l=o.some(e=>e._preloadRemoteFontOptions?.assets===!1);if(n&&(a||l)||o.push(d([],{assets:S.defaultAssets})),!o.some(e=>"fontLoader"===e._kind))throw Error("TypstCompiler: no font loader found, please use font loaders, e.g. loadFonts or preloadSystemFonts");this.compiler=await (0,i.buildComponent)(t,w(this.compilerJs),r,{})}setFonts(e){this.compiler.set_fonts(e)}compile(e){return new Promise(t=>{let s=this.compiler.snapshot(e.root,e.mainFilePath,j(e.inputs));t("incrementalServer"in e?s.incr_compile(e.incrementalServer[o.kObject],k(e.diagnostics)):s.get_artifact(e.format||r.vector,k(e.diagnostics)))})}async runWithWorld(e,t){let r=this.compiler.snapshot(e.root,e.mainFilePath,j(e.inputs)),s=await t(new g(r));return r.free(),s}query(e){return this.runWithWorld(e,async t=>JSON.parse(await t.query(e)))}getSemanticTokenLegend(){return new Promise(e=>{e(this.compiler.get_semantic_token_legend())})}getSemanticTokens(e){return new Promise(t=>{this.compiler.reset(),t(this.compiler.get_semantic_tokens(e.offsetEncoding||"utf-16",e.mainFilePath,e.resultId))})}async withIncrementalServer(e){let t=new m(this.compiler.create_incr_server());try{return await e(t)}finally{t[o.kObject].free()}}async getAst(e){return this.compiler.get_ast(e)}async reset(){await new Promise(e=>{this.compiler.reset(),e(void 0)})}addSource(e,t){if(arguments.length>2)throw Error("use of addSource(path, source, isMain) is deprecated, please use addSource(path, source) instead");this.compiler.add_source(e,t)}mapShadow(e,t){this.compiler.map_shadow(e,t)}unmapShadow(e){this.compiler.unmap_shadow(e)}resetShadow(){this.compiler.reset_shadow()}renderPageToCanvas(){throw Error("Please use the api TypstRenderer.renderToCanvas in v0.4.0")}}function j(e){return e?Object.entries(e):void 0}function k(e){switch(e){case"none":return 1;case"unix":return 2;default:return 3}}b._impl=S,e.s(["CompileFormatEnum",()=>r,"IncrementalServer",()=>m,"TypstFontBuilderDriver",()=>_,"TypstWorld",()=>g,"createTypstCompiler",()=>b,"createTypstFontBuilder",()=>y],29554)}]);